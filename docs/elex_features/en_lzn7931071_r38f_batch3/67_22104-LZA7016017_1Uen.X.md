---
complexity_score: 9.5
converted_at: '2025-08-13T06:58:18.722024Z'
file_type: html
format: html
image_processing_enhanced: true
images_extracted: 2
images_saved: 3
original_path: 67_22104-LZA7016017_1Uen.X.html
pictures_extracted: 2
processing_method: docling_multimodal
quality_score: 9.0
source_file: 67_22104-LZA7016017_1Uen.X.html
source_zip: en_lzn7931071_r38f.zip
tables_extracted: 5
zip_image_types:
- .svg
- .png
- .gif
- .jpg
- .bmp
zip_images_total: 2796
---

# 

NR UE Trace

Contents

![Image](../images/67_22104-LZA7016017_1Uen.X/additional_3_CP.png)

![Image](../images/67_22104-LZA7016017_1Uen.X/additional_3_CP.png)

- Overview
- Dependencies
- Feature Operation
    - NR SA
    - NR NSA
- Network Impact
- Parameters
- Performance
- Activate Non-License-Controlled Features

# 1 NR UE Trace Overview

Performance events from individual, operator-selected UEs that travel through the

network can be recorded by using NR UE Trace.

| Feature Name           | NR UE Trace                                             |
|------------------------|---------------------------------------------------------|
| Feature Identity       | FAJ 121 5214                                            |
| Value Package Name     | NR Base Package                                         |
| Value Package Identity | FAJ 801 4002                                            |
| Node Type              | Baseband Radio Node                                     |
| Access Type            | NR                                                      |
| Licensing              | Non-license-controlled feature. No license is required. |

Summary

NR UE Trace makes it possible to record performance events from individual, operator-selected

UEs that travel through the network. Radio events can be recorded for both the

uplink and downlink. Trace recordings can be collected in files or streamed to an

external receiver.

This feature helps operators evaluate, troubleshoot, and tune NR deployments in support of

improving or optimizing the user experience. For example, UE Trace recordings allow

the operator to identify parameters that might have to be adjusted, particularly

after changing or extending the network.

For more information on configuring UE Trace, see Manage Performance.

# 2 Dependencies of NR UE Trace

The Streaming of PM Events feature is a prerequisite to NR UE Trace if streaming

output is desired.

Table 1   Feature Dependencies

| Feature                                                               | Relationship   | Description                                                                                                                                                       |
|-----------------------------------------------------------------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Streaming of PM Events                                 (FAJ 121 4993) | Prerequisite   | The Streaming of PM Events feature allows streaming of live UE Trace                                 events through the TCP socket connection to a customer node. |

Hardware

No specific hardware requirement is expected for this feature.

Limitations

When tracing interfaces between the gNodeB managed functions, trace recordings are

only provided from the gNodeB-CU-CP and gNodeB-DU (F1-C interface). The E1 interface

to the gNodeB-CU-CP is not traced.

Streaming is not supported for NR SA gNodeB-CU-CP. For NR SA gNodeB-DU streaming is

activated through setting bits in TraceReference, not through 3GPP standard

activation method.

Only manual activation of UE Trace for NR SA is currently supported, see Manage Performance.

Network Requirements

UE Trace recordings are initiated from the core network. The minimum Packet Core

Controller (PCC) version required is 1.18. For information on starting and stopping

UE Trace recordings, see Manage Performance.

# 3 Feature Operation of NR UE Trace

PM events are recorded by NR UE Trace from the gNodeB-CU-CP and gNodeB-DU managed

functions. Trace recordings can be written to files for collection and decoding using ENM,

or streamed to an external receiver for decoding.

NR UE Trace records PM events from the gNodeB-CU-CP and gNodeB-DU managed functions.

Configuration and activation of the trace recording for a specific UE is initiated from

the core network. This is propagated to the NR managed functions using UE-associated

signaling. The trace recordings are in GPB format.

If the configuration specifies file output, ENM collects the files and enables the

operator to select and decode the files. If the configuration specifies stream output,

the NR managed functions stream the trace records to the designated receiver. The trace

recordings contain a trace reference, as specified in 3GPP TS 32.422. The trace

reference is common for all UE traces across all network elements involved in the call.

This facilitates analysis of the trace records from all of the participating network

elements associated with handling the call.

As the UE leaves the coverage area and it is passed over to the next network element, the

configuration data of the trace recording moves with the UE. Based on the configuration

data, performance events are written to files or streamed to an external receiver.

If events are written to files, they are collected by OSS following the Cell Trace ROP.

Selected UEs are identified by their IMSI by OSS. Within the RAN, the trace session for

a UE is uniquely identified by a trace reference.

Each managed function supports up to 16 simultaneous UE Trace jobs for files and up to 32

simultaneous UE Trace jobs for streaming.

For the list of PM events applicable to UE Trace and their association to trace depths

and interfaces, see Lists and Delta Lists - Referral Document. Specific events

from all UE Trace jobs can be filtered by using the attribute from

EventGroupSEventTypeS.eventTypeSId

attribute.

Within Lists and Delta Lists - Referral Document some UE type PM

Events are not possible to capture with UE trace as the UE context is never known when

the event is sent. These UE type PM Events do not have an associated interface or trace

depth.

There are also some UE type PM Events that have an assigned trace depth and interface

that are not always captured in UE trace, as the UE context is not known. For example,

CuCpXnRetreiveUEContextRequest may be generated on the node that

receives the request, as that node knows the UE context. However, the originating node

for the request does not capture the PM Event, as the UE context is not known. Another

example is CuCpNgDownlinkNasTransport. This is captured by UE trace

as long as UE-associated logical NG connection exists. There is a use case where the AMF

sends the DOWNLINK NAS TRANSPORT message in response to an

INITIAL UE MESSAGE before the UE context is known. In this case,

the DOWNLINK NAS TRANSPORT message is not captured by UE trace. There

are also failure conditions that may or may not generate an event, depending if the UE

context is known.

The following PM Events can be traced, but only when the UE context is known:

- CuCpNgDownlinkNasTransport
- CuCpNgNasNonDeliveryIndication
- CuCpNgUplinkNasTransport
- CuCpXnRetrieveUeContextRequest
- CuCpXnRetrieveUeContextFailure

Operational Process

Figure 1   Operational Sequence Diagram

1. Preparing for UE Trace For more detailed information on preparing for UE Trace, see Manage Performance.
2. Start and stop UE Trace For more detailed information on starting or stopping UE Trace, see Manage Performance.
3. Collecting UE Trace recordings For more detailed information on collecting UE Trace recordings, see Manage Performance. For more information on the streaming format of UE Trace recordings and the renaming of UE Trace recording files, see Performance Event Format.
4. Decoding UE Trace recordings If file output is used for the trace recording, ENM may be used to select UE Trace recording files and decode their content. If stream output is used for the trace recording, then it is required that the stream receiver is built with a GPB decoder. For more information on decoding UE Trace recordings, see Manage Performance.
5. Analyzing mobility using NR UE Trace When a UE is traced as it moves through the network, a trace reference is assigned for the trace session. This trace reference is present in all PM events associated with the trace session and included in the name of the file produced for file output. Additionally, a trace recording session reference is included in all PM events produced by NR UE Trace. This is standardized as specified in 3GPP TS 32.422 and facilitates analyses of UE Trace recordings between the various network elements involved with the overall call for the UE. This includes handovers, interactions with the core, and interactions with the UE. Standardized ASN.1 messaging is described in 3GPP specifications for the various interfaces, such as X2AP (see 3GPP TS 36.423) and F1AP (see 3GPP TS 38.473).

## 3.1 NR SA

UE Trace recordings produced by the gNodeB-CU-CP and gNodeB-DU managed functions of the

gNodeB are controlled through the NG interface between the AMF and the gNodeB.

Trace activation occurs in one of the following cases:

- INITIAL CONTEXT SETUP REQUEST message is received from the AMF.
- When there is an ongoing call and a TRACE START message originated by the OSS is sent through the AMF to the gNodeB.

Tracing stops when a DEACTIVATE TRACE message originated by the OSS is

sent through the AMF to the gNodeB, or when the UE is released.

## 3.2 NR NSA

UE Trace recordings produced by the gNodeB-CU-CP and gNodeB-DU managed functions of the

gNodeB are controlled from the MME through the eNodeB.

Trace activation occurs in one of the following cases:

- When dual connectivity is being set up and the SGNB ADDITION REQUEST message is passed from the eNodeB to the gNodeB.
- When there is an ongoing dual connectivity call and a TRACE START message originated by the MME is passed from the eNodeB to the gNodeB.

Tracing stops when a DEACTIVATE TRACE message originated by the MME is

passed from the eNodeB to the gNodeB, or when the UE is released.

This way, the gNodeB-CU-CP and gNodeB-DU managed functions record the radio events of a

UE when it is dual connected and the UE Trace is activated.

The trace depth and interfaces for UE Trace in the gNodeB are synchronized with the

eNodeB. If it is desired, the tracing of the F1 interface of the gNodeB can be enabled

by setting the PmEventService.ueTraceSyncF1AndE1WithX2 attribute to

true on the Primary eNodeB.

# 4 Network Impact of NR UE Trace

NR UE Trace has an impact on capacity and performance. The feature also introduces

support for the Trace Activation information element in several messages.

Capacity and Performance

Memory and bandwidth consumption increase proportionally to the number of UEs traced,

the number of traced interfaces, and trace depth. There is a 16-file and 32-stream

limit for UE trace jobs. The increase of consumption is only applicable, if the

deployment is NR SA and more than 16-stream jobs are used.

Interfaces

The Trace Activation information element for NR SA is supported in the following

messages:

- NGAP: INITIAL CONTEXT SETUP REQUEST
- NGAP: HANDOVER REQUEST
- XnAP: HANDOVER REQUEST
- XnAP: RETRIEVE UE CONTEXT RESPONSE
- NGAP: TRACE START
- NGAP: DEACTIVATE TRACE

The Trace Activation information element for NR NSA is supported in the following

messages:

- X2AP: SGNB ADDITION REQUEST
- X2AP: TRACE START
- X2AP: DEACTIVATE TRACE
- F1AP: UE CONTEXT SETUP
- F1AP: TRACE START
- F1AP: DEACTIVATE TRACE

Other Network Elements

The Primary eNodeB must be upgraded to a software level that supports the above NR

NSA interface changes.

# 5 Parameters for NR UE Trace

NR UE Trace supports MOM attributes.

Table 2   Parameters

| Parameter                                  | Type     | Description                                                                                                                                                                                  |
|--------------------------------------------|----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| PmEventService.ueTraceSyncF1AndE1WithX2(1) | Affected | The tracing of the F1 and E1 interfaces of the gNodeB can be enabled                                 by setting the attribute to true on the Primary                                 eNodeB. |
| EventProducerS.streamDestinationPort       | Affected | Specifies the TCP port to be used for streaming UE Trace jobs.                                                                                                                               |
| EventTypeS.eventTypeSId                    | Affected | The attribute based on which events can be excluded from UE Trace                                 jobs.                                                                                      |

(1)

Valid for NR NSA only.

# 6 Performance of NR UE Trace

KPIs

This feature has no associated Key Performance Indicators (KPIs).

Counters

This feature has no directly associated counters.

Events

- CuCpX2TraceStart
- CuCpX2DeactivateTrace
- CuCpF1TraceStart
- CuCpF1DeactivateTrace
- DuF1TraceStart
- DuF1DeactivateTrace
- StartRecordingSession
- StopRecordingSession
- RecordingSessionMaxUeTraceFilesReached
- RecordingSessionMaxStreamedUeTracesReached
- CuCpNgTraceStart
- CuCpNgDeactivateTrace
- CuCpNgTraceFailureIndication

# 7 Activate Non-License-Controlled Features

Non-license-controlled features do not require manual activation and cannot be

deactivated.

While license-controlled features need to be activated, non-license-controlled features

are activated automatically during node integration. They also do not

have

a software license key associated, which means that they have no

entries in the LKF that is installed on the node.

In some cases, non-license-controlled features need to be configured

manually or have some of

their

subfunctions enabled to work properly.